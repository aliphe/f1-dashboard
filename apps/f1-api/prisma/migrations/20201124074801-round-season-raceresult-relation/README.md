# Migration `20201124074801-round-season-raceresult-relation`

This migration has been generated by Matthias Alif at 11/24/2020, 8:48:01 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "RaceResult.position_raceId_unique"

ALTER TABLE "RaceResult" DROP CONSTRAINT "RaceResult_raceId_fkey"

ALTER TABLE "Race" DROP CONSTRAINT "Race_pkey",
DROP COLUMN "id"

ALTER TABLE "RaceResult" DROP COLUMN "raceId",
ADD COLUMN     "raceRound" INTEGER NOT NULL,
ADD COLUMN     "raceSeasonYear" INTEGER NOT NULL

CREATE UNIQUE INDEX "RaceResult.position_raceRound_raceSeasonYear_unique" ON "RaceResult"("position", "raceRound", "raceSeasonYear")

ALTER TABLE "RaceResult" ADD FOREIGN KEY("raceRound", "raceSeasonYear")REFERENCES "Race"("round","seasonYear") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201124071746-remove-raceresult-id..20201124074801-round-season-raceresult-relation
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -52,9 +52,8 @@
   Race      Race[]
 }
 model Race {
-  id         Int          @id @default(autoincrement())
   round      Int
   seasonYear Int
   name       String
   season     Season       @relation(fields: [seasonYear], references: [year])
@@ -83,15 +82,16 @@
   team   Team   @relation(fields: [teamId], references: [id])
   teamId String
-  race   Race @relation(fields: [raceId], references: [id])
-  raceId Int
+  raceRound      Int
+  raceSeasonYear Int
+  race           Race @relation(fields: [raceRound, raceSeasonYear], references: [round, seasonYear])
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  @@unique([position, raceId])
+  @@unique([position, raceRound, raceSeasonYear])
 }
 model DriverStanding {
   position Int @id
```
