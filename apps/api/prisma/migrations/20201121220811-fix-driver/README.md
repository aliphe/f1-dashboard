# Migration `20201121220811-fix-driver`

This migration has been generated by Matthias Alif at 11/21/2020, 11:08:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Season" DROP CONSTRAINT "Season_constructorId_fkey"

ALTER TABLE "Season" DROP CONSTRAINT "Season_driverId_fkey"

ALTER TABLE "Season" DROP COLUMN "driverId",
DROP COLUMN "constructorId"

CREATE TABLE "_DriverToSeason" (
    "A" TEXT NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE TABLE "_ConstructorToSeason" (
    "A" TEXT NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "_DriverToSeason_AB_unique" ON "_DriverToSeason"("A", "B")

CREATE INDEX "_DriverToSeason_B_index" ON "_DriverToSeason"("B")

CREATE UNIQUE INDEX "_ConstructorToSeason_AB_unique" ON "_ConstructorToSeason"("A", "B")

CREATE INDEX "_ConstructorToSeason_B_index" ON "_ConstructorToSeason"("B")

ALTER TABLE "_DriverToSeason" ADD FOREIGN KEY("A")REFERENCES "Driver"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_DriverToSeason" ADD FOREIGN KEY("B")REFERENCES "Season"("year") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ConstructorToSeason" ADD FOREIGN KEY("A")REFERENCES "Constructor"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_ConstructorToSeason" ADD FOREIGN KEY("B")REFERENCES "Season"("year") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201121212407-standings-relations..20201121220811-fix-driver
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -43,10 +43,10 @@
   position Int @id
   points   Int
   wins     Int
+  season     Season @relation(fields: [seasonYear], references: [year])
   seasonYear Int
-  season     Season @relation(fields: [seasonYear], references: [year])
   driver   Driver @relation(fields: [driverId], references: [id])
   driverId String
@@ -70,12 +70,10 @@
   updatedAt DateTime @updatedAt
 }
 model Season {
-  year                Int                   @id
-  Driver              Driver?               @relation(fields: [driverId], references: [id])
-  driverId            String?
-  Constructor         Constructor?          @relation(fields: [constructorId], references: [id])
-  constructorId       String?
-  DriverStanding      DriverStanding[]
-  ConstructorStanding ConstructorStanding[]
+  year                 Int                   @id
+  drivers              Driver[]
+  constructors         Constructor[]
+  driverStandings      DriverStanding[]
+  constructorStandings ConstructorStanding[]
 }
```


